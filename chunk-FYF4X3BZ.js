import{a as N}from"./chunk-IXFK2POQ.js";import{a as F}from"./chunk-LNJWQYDK.js";import"./chunk-ZYWFXMK7.js";import"./chunk-4VDU63PD.js";import{Fa as O,Ka as D,Oa as y,Qb as z,Rb as T,Va as m,Vb as L,Wa as n,Xa as e,Ya as w,db as P,fb as x,lb as E,mb as k,ob as a,pb as u,q as I,qb as v,rb as C,va as o,w as A}from"./chunk-VD7T3VHC.js";function G(i,s){if(i&1&&(n(0,"div",13),a(1),e()),i&2){let t=x();o(),v(" ",t.errorMessage," ")}}function H(i,s){i&1&&(n(0,"div",14),a(1," Loading reports data... "),e())}function K(i,s){if(i&1&&(n(0,"div",15)(1,"div",16)(2,"div",17)(3,"p",18),a(4,"Attendance Rate"),e(),n(5,"span",19),a(6,"\u{1F4C8}"),e()(),n(7,"p",20),a(8),e(),n(9,"p",21),a(10),e()(),n(11,"div",16)(12,"div",17)(13,"p",18),a(14,"Late Arrival Rate"),e(),n(15,"span",22),a(16,"\u26A0\uFE0F"),e()(),n(17,"p",20),a(18),e(),n(19,"p",21),a(20),e()(),n(21,"div",16)(22,"div",17)(23,"p",18),a(24,"Total Absences"),e(),n(25,"span",23),a(26,"\u{1F4CA}"),e()(),n(27,"p",20),a(28),e(),n(29,"p",21),a(30),e()()()),i&2){let t=x();o(8),v("",t.monthlyStats.attendanceRate,"%"),o(2),u(t.monthlyStats.period),o(8),v("",t.monthlyStats.lateArrivalRate,"%"),o(2),u(t.monthlyStats.period),o(8),u(t.monthlyStats.totalAbsences),o(2),u(t.monthlyStats.period)}}function Q(i,s){if(i&1&&(n(0,"p",29),a(1),e()),i&2){let t=x(2);o(),C(" Period: ",t.monthlyStats.period," (",t.monthlyStats.totalDays," days) ")}}function V(i,s){if(i&1&&(n(0,"p",46),a(1),e()),i&2){let t=x().$implicit;o(),C(" ",t.lateArrivals," late arrival",t.lateArrivals>1?"s":""," ")}}function X(i,s){if(i&1&&(n(0,"div",32)(1,"div",33)(2,"div",34)(3,"div",35)(4,"p",36),a(5),e(),n(6,"p",37),a(7),e()(),n(8,"div",38)(9,"p",39),a(10),e(),n(11,"p",40),a(12,"Days present"),e(),y(13,V,2,2,"p",41),e()(),n(14,"div",42)(15,"div",43),w(16,"div",44),e(),n(17,"span",45),a(18),e()()()()),i&2){let t=s.$implicit;o(5),u(t.name),o(2),u(t.department),o(3),C("",t.daysPresent," / ",t.totalDays),o(3),m("ngIf",t.lateArrivals>0),o(3),E("width",t.percentage,"%"),k("progress-low",t.percentage<70)("progress-medium",t.percentage>=70&&t.percentage<90)("progress-high",t.percentage>=90),o(2),v("",t.percentage,"%")}}function Z(i,s){if(i&1&&(n(0,"div",30),y(1,X,19,14,"div",31),e()),i&2){let t=x(2);o(),m("ngForOf",t.staffReports)}}function tt(i,s){i&1&&(n(0,"div",47)(1,"p"),a(2,"No attendance data available for this period"),e()())}function et(i,s){if(i&1&&(n(0,"div",24)(1,"h2",25),a(2,"Staff Attendance Summary"),e(),y(3,Q,2,2,"p",26)(4,Z,2,1,"div",27)(5,tt,3,0,"div",28),e()),i&2){let t=x();o(3),m("ngIf",t.monthlyStats),o(),m("ngIf",t.staffReports.length>0),o(),m("ngIf",t.staffReports.length===0)}}var $=class i{constructor(s,t){this.staffService=s;this.attendanceService=t}monthlyStats=null;staffReports=[];isLoading=!1;errorMessage="";ngOnInit(){this.loadReports()}loadReports(){this.isLoading=!0,this.errorMessage="";let{startDate:s,endDate:t,totalDays:r,period:d}=this.getCurrentMonthRange();A({staff:this.staffService.getAllStaff(),attendances:this.getAttendancesForMonth(s,t)}).subscribe({next:({staff:l,attendances:g})=>{this.calculateReports(l,g,r,d),this.isLoading=!1},error:l=>{this.errorMessage="Failed to load reports data",this.isLoading=!1,console.error("Error loading reports:",l)}})}getCurrentMonthRange(){let s=new Date,t=s.getFullYear(),r=s.getMonth(),d=new Date(t,r,1),l=new Date(t,r,s.getDate()),g=Math.floor((l.getTime()-d.getTime())/(1e3*60*60*24))+1,h=d.toISOString().split("T")[0],S=l.toISOString().split("T")[0],b=`${["January","February","March","April","May","June","July","August","September","October","November","December"][r]} ${t}`;return{startDate:h,endDate:S,totalDays:g,period:b}}getAttendancesForMonth(s,t){return this.attendanceService.getAllAttendance().pipe(I(r=>r.filter(d=>{let l=d.date.toISOString().split("T")[0];return l>=s&&l<=t})))}calculateReports(s,t,r,d){let l=s.filter(c=>c.active!==!1),g=l.length,S=new Set(t.map(c=>parseInt(c.staffId))).size,p=g*r,b=t.filter(c=>c.checkIn).length,j=p>0?b/p*100:0,Y=t.filter(c=>{if(!c.checkIn)return!1;let[f,M]=c.checkIn.split(":").map(Number);return f>9||f===9&&M>0}).length,J=b>0?Y/b*100:0,U=p-b;this.monthlyStats={attendanceRate:Math.round(j*10)/10,lateArrivalRate:Math.round(J*10)/10,totalAbsences:Math.max(0,U),totalDays:r,period:d},this.staffReports=l.map(c=>{let f=t.filter(_=>parseInt(_.staffId)===c.userId),M=f.filter(_=>_.checkIn).length,B=f.filter(_=>{if(!_.checkIn)return!1;let[R,q]=_.checkIn.split(":").map(Number);return R>9||R===9&&q>0}).length,W=r>0?Math.round(M/r*100):0;return{name:c.name?`${c.name} ${c.surname||""}`.trim():"Unknown",department:c.departmentName||"N/A",daysPresent:M,totalDays:r,percentage:W,lateArrivals:B}}),this.staffReports.sort((c,f)=>f.percentage-c.percentage)}exportReport(){if(this.staffReports.length===0){alert("No data to export");return}let s=["Name","Department","Days Present","Total Days","Attendance %","Late Arrivals"],t=this.staffReports.map(p=>[p.name,p.department,p.daysPresent.toString(),p.totalDays.toString(),`${p.percentage}%`,p.lateArrivals.toString()]);this.monthlyStats&&(t.push([]),t.push(["Summary","","","","",""]),t.push(["Period",this.monthlyStats.period,"","","",""]),t.push(["Total Days",this.monthlyStats.totalDays.toString(),"","","",""]),t.push(["Attendance Rate",`${this.monthlyStats.attendanceRate}%`,"","","",""]),t.push(["Late Arrival Rate",`${this.monthlyStats.lateArrivalRate}%`,"","","",""]),t.push(["Total Absences",this.monthlyStats.totalAbsences.toString(),"","","",""]));let r=[s.join(","),...t.map(p=>p.join(","))].join(`
`),d=new Blob([r],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),g=URL.createObjectURL(d);l.setAttribute("href",g);let h=new Date,S=`attendance-report-${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}-${String(h.getDate()).padStart(2,"0")}.csv`;l.setAttribute("download",S),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}refreshReports(){this.loadReports()}static \u0275fac=function(t){return new(t||i)(O(N),O(F))};static \u0275cmp=D({type:i,selectors:[["app-reports"]],decls:19,vars:7,consts:[[1,"reports-container"],[1,"page-header"],[1,"header-content"],[1,"page-title"],[1,"page-subtitle"],[1,"header-actions"],[1,"btn-refresh",3,"click","disabled"],[1,"btn-export-report",3,"click","disabled"],[1,"export-icon"],["class","error-message",4,"ngIf"],["class","loading-indicator",4,"ngIf"],["class","stats-grid",4,"ngIf"],["class","summary-card",4,"ngIf"],[1,"error-message"],[1,"loading-indicator"],[1,"stats-grid"],[1,"stat-card"],[1,"stat-header"],[1,"stat-label"],[1,"stat-icon","stat-icon-green"],[1,"stat-value"],[1,"stat-period"],[1,"stat-icon","stat-icon-amber"],[1,"stat-icon","stat-icon-red"],[1,"summary-card"],[1,"summary-title"],["class","summary-subtitle",4,"ngIf"],["class","summary-list",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"summary-subtitle"],[1,"summary-list"],["class","summary-item",4,"ngFor","ngForOf"],[1,"summary-item"],[1,"summary-info"],[1,"summary-header"],[1,"staff-info"],[1,"staff-name"],[1,"staff-department"],[1,"attendance-stats"],[1,"days-present"],[1,"days-label"],["class","late-info",4,"ngIf"],[1,"progress-container"],[1,"progress-bar"],[1,"progress-fill"],[1,"percentage-label"],[1,"late-info"],[1,"empty-state"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),a(4,"Reports & Analytics"),e(),n(5,"p",4),a(6,"Attendance insights and trends"),e()(),n(7,"div",5)(8,"button",6),P("click",function(){return r.refreshReports()}),a(9),e(),n(10,"button",7),P("click",function(){return r.exportReport()}),n(11,"span",8),a(12,"\u2B07"),e(),n(13,"span"),a(14,"Export Report"),e()()()(),y(15,G,2,1,"div",9)(16,H,2,0,"div",10)(17,K,31,6,"div",11)(18,et,6,3,"div",12),e()),t&2&&(o(8),m("disabled",r.isLoading),o(),v(" ",r.isLoading?"Loading...":"\u{1F504} Refresh"," "),o(),m("disabled",r.isLoading||r.staffReports.length===0),o(5),m("ngIf",r.errorMessage),o(),m("ngIf",r.isLoading),o(),m("ngIf",r.monthlyStats&&!r.isLoading),o(),m("ngIf",!r.isLoading))},dependencies:[L,z,T],styles:['.reports-container[_ngcontent-%COMP%]{padding:32px;background-color:#f8f9fa;min-height:100vh}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:32px}.header-content[_ngcontent-%COMP%]{flex:1}.page-title[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#1a202c;margin:0 0 6px;letter-spacing:-.02em}.page-subtitle[_ngcontent-%COMP%]{font-size:14px;color:#718096;margin:0;font-weight:400}.btn-export-report[_ngcontent-%COMP%]{background:#3b82f6;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:14px;font-weight:600;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s}.btn-export-report[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb;transform:translateY(-1px);box-shadow:0 4px 12px #3b82f64d}.btn-export-report[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.btn-refresh[_ngcontent-%COMP%]{background:#f1f5f9;color:#475569;border:none;padding:12px 24px;border-radius:8px;font-size:14px;font-weight:600;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s}.btn-refresh[_ngcontent-%COMP%]:hover:not(:disabled){background:#e2e8f0;transform:translateY(-1px)}.btn-refresh[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.export-icon[_ngcontent-%COMP%]{font-size:16px}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px;margin-bottom:32px}.stat-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:24px;box-shadow:0 1px 3px #0000000d;border:1px solid #e2e8f0;transition:all .2s}.stat-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 6px #00000012;transform:translateY(-2px)}.stat-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}.stat-label[_ngcontent-%COMP%]{font-size:14px;color:#718096;font-weight:500;margin:0}.stat-icon[_ngcontent-%COMP%]{font-size:20px}.stat-icon-green[_ngcontent-%COMP%]{color:#10b981}.stat-icon-amber[_ngcontent-%COMP%]{color:#f59e0b}.stat-icon-red[_ngcontent-%COMP%]{color:#ef4444}.stat-value[_ngcontent-%COMP%]{font-size:36px;font-weight:700;color:#1a202c;margin:0 0 4px;line-height:1.2}.stat-period[_ngcontent-%COMP%]{font-size:12px;color:#a0aec0;margin:0}.summary-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:28px;box-shadow:0 1px 3px #0000000d;border:1px solid #e2e8f0}.summary-title[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#1a202c;margin:0 0 8px}.summary-subtitle[_ngcontent-%COMP%]{font-size:14px;color:#718096;margin:0 0 24px}.summary-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.summary-item[_ngcontent-%COMP%]{display:flex;align-items:center}.summary-info[_ngcontent-%COMP%]{flex:1}.summary-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}.staff-info[_ngcontent-%COMP%]{flex:1}.staff-name[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:#1a202c;margin:0 0 4px}.staff-department[_ngcontent-%COMP%]{font-size:13px;color:#718096;margin:0}.attendance-stats[_ngcontent-%COMP%]{text-align:right}.days-present[_ngcontent-%COMP%]{font-size:14px;color:#4a5568;font-weight:500;margin:0 0 4px}.days-label[_ngcontent-%COMP%]{font-size:12px;color:#a0aec0;margin:0 0 4px}.late-info[_ngcontent-%COMP%]{font-size:11px;color:#f59e0b;margin:0;font-weight:500}.progress-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.progress-bar[_ngcontent-%COMP%]{flex:1;height:8px;background:#e2e8f0;border-radius:10px;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{height:100%;background:#3b82f6;border-radius:10px;transition:width .3s ease;position:relative}.progress-low[_ngcontent-%COMP%]{background:#ef4444}.progress-medium[_ngcontent-%COMP%]{background:#f59e0b}.progress-high[_ngcontent-%COMP%]{background:#10b981}.progress-fill[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2));animation:_ngcontent-%COMP%_shimmer 2s infinite}@keyframes _ngcontent-%COMP%_shimmer{0%{transform:translate(-100%)}to{transform:translate(100%)}}.percentage-label[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#1a202c;min-width:50px;text-align:right}.error-message[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b;padding:12px 16px;border-radius:8px;margin-bottom:16px;font-size:14px;border-left:4px solid #ef4444}.loading-indicator[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{text-align:center;padding:24px;color:#718096;font-size:14px}@media (max-width: 1024px){.reports-container[_ngcontent-%COMP%]{padding:20px}.stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.page-header[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.btn-export-report[_ngcontent-%COMP%]{width:100%;justify-content:center}}@media (max-width: 768px){.reports-container[_ngcontent-%COMP%]{padding:16px}.page-title[_ngcontent-%COMP%]{font-size:24px}.stat-card[_ngcontent-%COMP%]{padding:20px}.stat-value[_ngcontent-%COMP%]{font-size:32px}.summary-card[_ngcontent-%COMP%]{padding:20px}.summary-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.attendance-stats[_ngcontent-%COMP%]{text-align:left}.progress-container[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:8px}.percentage-label[_ngcontent-%COMP%]{text-align:left}}']})};export{$ as Reports};
