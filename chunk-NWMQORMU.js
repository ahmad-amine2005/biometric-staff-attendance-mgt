import{a as T}from"./chunk-WNQ4BRPW.js";import{a as O}from"./chunk-IXFK2POQ.js";import{a as L}from"./chunk-LNJWQYDK.js";import"./chunk-ZYWFXMK7.js";import"./chunk-4VDU63PD.js";import{Fa as h,Ka as b,Oa as v,Qb as C,Rb as y,Va as o,Vb as M,Wa as i,Xa as t,Ya as _,db as I,fb as g,lb as D,mb as E,ob as a,pb as m,qb as x,rb as k,va as d}from"./chunk-VD7T3VHC.js";function N(r,s){if(r&1&&(i(0,"div",14),a(1),t()),r&2){let e=g();d(),x(" ",e.errorMessage," ")}}function z(r,s){r&1&&(i(0,"div",15),a(1," Loading dashboard data... "),t())}function j(r,s){if(r&1&&(i(0,"div",16)(1,"div",17)(2,"div",18),a(3," \u{1F465} "),t(),i(4,"div",19),a(5,"Total Staff"),t(),i(6,"div",20),a(7),t()(),i(8,"div",17)(9,"div",21),a(10," \u2713 "),t(),i(11,"div",19),a(12,"Present Today"),t(),i(13,"div",20),a(14),t()(),i(15,"div",17)(16,"div",22),a(17," \u2717 "),t(),i(18,"div",19),a(19,"Absent"),t(),i(20,"div",20),a(21),t()(),i(22,"div",17)(23,"div",23),a(24," \u23F0 "),t(),i(25,"div",19),a(26,"Late Arrivals"),t(),i(27,"div",20),a(28),t()(),i(29,"div",17)(30,"div",18),a(31," \u{1F4CA} "),t(),i(32,"div",19),a(33,"Attendance Rate"),t(),i(34,"div",20),a(35),t()()()),r&2){let e=g();d(7),m(e.stats.totalStaff),d(7),m(e.stats.presentToday),d(7),m(e.stats.absent),d(7),m(e.stats.lateArrivals),d(7),x("",e.stats.attendanceRate,"%")}}function H(r,s){if(r&1&&(i(0,"div",26)(1,"div",27)(2,"h4"),a(3),t(),i(4,"p"),a(5),t()(),i(6,"div",28)(7,"p"),a(8),t(),i(9,"p"),a(10,"Check-in time"),t()()()),r&2){let e=s.$implicit;d(3),m(e.name),d(),E("late",e.status==="Late"),d(),m(e.status),d(3),m(e.time)}}function $(r,s){if(r&1&&(i(0,"div",24),v(1,H,11,5,"div",25),t()),r&2){let e=g();d(),o("ngForOf",e.recentCheckIns)}}function B(r,s){r&1&&(i(0,"div",29)(1,"p"),a(2,"No check-ins today yet"),t()())}function W(r,s){r&1&&(i(0,"div",30)(1,"p"),a(2,"Loading check-ins..."),t()())}function Y(r,s){if(r&1&&(i(0,"div",33)(1,"div",34)(2,"span"),a(3),t(),i(4,"span"),a(5),t()(),i(6,"div",35),_(7,"div",36),t()()),r&2){let e=s.$implicit,n=g(2);d(3),m(e.dpmtName),d(2),k("",e.activeStaff||0,"/",e.totalStaff||0),d(2),D("width",n.getAttendancePercentage(e),"%")}}function q(r,s){if(r&1&&(i(0,"div",31),v(1,Y,8,5,"div",32),t()),r&2){let e=g();d(),o("ngForOf",e.departments)}}function G(r,s){r&1&&(i(0,"div",29)(1,"p"),a(2,"No departments found"),t()())}function J(r,s){r&1&&(i(0,"div",30)(1,"p"),a(2,"Loading departments..."),t()())}var P=class r{constructor(s,e,n){this.staffService=s;this.attendanceService=e;this.departmentService=n}stats=null;departments=[];recentCheckIns=[];isLoading=!1;errorMessage="";ngOnInit(){this.loadData()}loadData(){this.isLoading=!0,this.errorMessage="";let s=new Date().toISOString().split("T")[0];this.attendanceService.getAttendancesByDate(s).subscribe({next:e=>{this.staffService.getAllStaff().subscribe({next:n=>{let l=n.length,p=n.filter(f=>f.active!==!1).length,c=e.filter(f=>f.checkIn).length,u=e.filter(f=>{if(!f.checkIn)return!1;let[S,F]=f.checkIn.split(":").map(Number);return S>9||S===9&&F>0}).length,A=p-c,R=p>0?c/p*100:0,w=c>0?u/c*100:0;this.stats={totalStaff:l,presentToday:c,absent:Math.max(0,A),lateArrivals:u,onLeave:0,attendanceRate:Math.round(R*10)/10,lateArrivalRate:Math.round(w*10)/10},this.loadRecentCheckIns(e),this.isLoading=!1},error:n=>{this.errorMessage="Failed to load staff data",this.isLoading=!1,console.error("Error loading staff:",n)}})},error:e=>{this.errorMessage="Failed to load attendance data",this.isLoading=!1,console.error("Error loading attendance:",e)}}),this.loadDepartments()}loadDepartments(){this.departmentService.getAllDepartments().subscribe({next:s=>{this.departments=s},error:s=>{console.error("Error loading departments:",s)}})}loadRecentCheckIns(s){let e=s.filter(n=>n.checkIn).map(n=>{let[l,p]=n.checkIn.split(":").map(Number),c=new Date;return c.setHours(l,p,0,0),{attendance:n,time:c}}).sort((n,l)=>l.time.getTime()-n.time.getTime()).slice(0,5).map(n=>{let[l,p]=n.attendance.checkIn.split(":").map(Number),c=l>9||l===9&&p>0;return{name:n.attendance.staffName,time:n.attendance.checkIn,status:c?"Late":"On time"}});this.recentCheckIns=e}getAttendancePercentage(s){let e=s.totalStaff||0,n=s.activeStaff||0;return e>0?Math.round(n/e*100):0}refreshData(){this.loadData()}static \u0275fac=function(e){return new(e||r)(h(O),h(L),h(T))};static \u0275cmp=b({type:r,selectors:[["app-dashboard"]],decls:27,vars:11,consts:[[1,"page-container"],[1,"page-header"],[1,"btn-refresh",3,"click","disabled"],["class","error-message",4,"ngIf"],["class","loading-indicator",4,"ngIf"],["class","stats-grid",4,"ngIf"],[1,"grid-2"],[1,"card"],[1,"card-header"],[1,"card-title"],["class","checkin-list",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","loading-state",4,"ngIf"],["class","department-list",4,"ngIf"],[1,"error-message"],[1,"loading-indicator"],[1,"stats-grid"],[1,"stat-card"],[1,"stat-card-icon","blue"],[1,"stat-card-label"],[1,"stat-card-value"],[1,"stat-card-icon","green"],[1,"stat-card-icon","red"],[1,"stat-card-icon","yellow"],[1,"checkin-list"],["class","checkin-item",4,"ngFor","ngForOf"],[1,"checkin-item"],[1,"checkin-info"],[1,"checkin-time"],[1,"empty-state"],[1,"loading-state"],[1,"department-list"],["class","department-item",4,"ngFor","ngForOf"],[1,"department-item"],[1,"department-item-header"],[1,"progress-bar"],[1,"progress-bar-fill"]],template:function(e,n){e&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h1"),a(4,"Dashboard"),t(),i(5,"p"),a(6,"Welcome back! Here's today's attendance overview"),t()(),i(7,"button",2),I("click",function(){return n.refreshData()}),a(8),t()(),v(9,N,2,1,"div",3)(10,z,2,0,"div",4)(11,j,36,5,"div",5),i(12,"div",6)(13,"div",7)(14,"div",8)(15,"h2",9),a(16,"Recent Check-Ins"),t()(),v(17,$,2,1,"div",10)(18,B,3,0,"div",11)(19,W,3,0,"div",12),t(),i(20,"div",7)(21,"div",8)(22,"h2",9),a(23,"Department Overview"),t()(),v(24,q,2,1,"div",13)(25,G,3,0,"div",11)(26,J,3,0,"div",12),t()()()),e&2&&(d(7),o("disabled",n.isLoading),d(),x(" ",n.isLoading?"Loading...":"\u{1F504} Refresh"," "),d(),o("ngIf",n.errorMessage),d(),o("ngIf",n.isLoading&&!n.stats),d(),o("ngIf",n.stats),d(6),o("ngIf",n.recentCheckIns.length>0),d(),o("ngIf",n.recentCheckIns.length===0&&!n.isLoading),d(),o("ngIf",n.isLoading),d(5),o("ngIf",n.departments.length>0),d(),o("ngIf",n.departments.length===0&&!n.isLoading),d(),o("ngIf",n.isLoading))},dependencies:[M,C,y],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 8px;font-size:28px;font-weight:700;color:#1a202c}.page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#718096;font-size:14px}.error-message[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b;padding:12px 16px;border-radius:8px;margin-bottom:16px;font-size:14px;border-left:4px solid #ef4444}.loading-indicator[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]{text-align:center;padding:24px;color:#718096;font-size:14px}.btn-refresh[_ngcontent-%COMP%]{background:#3b82f6;color:#fff;border:none;padding:8px 16px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s}.btn-refresh[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb;transform:translateY(-1px)}.btn-refresh[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.late[_ngcontent-%COMP%]{color:#dc2626;font-weight:600}"]})};export{P as Dashboard};
